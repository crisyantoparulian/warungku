Dokumentasi Teknis: Sistem Manajemen Produk Telegram
1. Ikhtisar Sistem
Sistem ini berfungsi sebagai Agen Database yang dioperasikan melalui Telegram. Pengguna (pemilik toko) dapat mengirimkan perintah dalam bahasa alami (Bahasa Indonesia) untuk mencari (READ), menambah (CREATE), atau memperbarui (UPDATE) harga produk.

LLM (GLM) tidak akan menulis query SQL secara langsung. Ini adalah praktik yang tidak aman (rentan terhadap SQL Injection). Sebaliknya, kita akan menggunakan pendekatan Function Calling (atau Tool Use). LLM hanya akan bertugas untuk memahami maksud pengguna dan mengubahnya menjadi panggilan fungsi yang sudah kita definisikan di dalam layanan kita.

2. Rekomendasi Tumpukan Teknologi (Tech Stack)
User Interface: Telegram Bot

Database: Supabase (PostgreSQL)

LLM: GLM (via API)

Layanan Backend (Service): Python dengan FastAPI

Mengapa FastAPI? Sangat ringan, cepat, modern, dan ideal untuk membuat API webhook yang akan menerima data dari Telegram.

Kerangka Kerja LLM (Glue): LangChain (Python)

Ini adalah "praktik terbaik" yang Anda cari. LangChain sangat menyederhanakan interaksi dengan LLM, terutama untuk kasus penggunaan "Agent" dan "Tool Use" seperti ini.

Deployment (Gratis): Vercel atau Render

Vercel: Sempurna untuk hosting aplikasi FastAPI sebagai Serverless Functions. Sangat cepat untuk di-deploy dan memiliki tier gratis yang ideal untuk proyek ini.

Render: Alternatif yang bagus, menawarkan layanan web gratis (mungkin sedikit lebih lambat untuk start awal) yang dapat menjalankan server FastAPI Anda 24/7.

3. Skema Database (Supabase)
Anda hanya memerlukan dua tabel minimalis seperti yang Anda sarankan. Ini adalah skrip SQL untuk membuatnya di editor SQL Supabase Anda.

SQL

-- 1. Tabel untuk menyimpan produk utama
CREATE TABLE products (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,  -- Nama produk unik, misal: "minyak", "gula", "beras"
    price INTEGER NOT NULL,       -- Harga dalam rupiah, misal: 4000
    unit TEXT,                  -- Satuan, misal: "liter", "kg", "pcs" (opsional)
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Buat index untuk pencarian nama yang lebih cepat dan tidak case-sensitive
CREATE INDEX idx_products_name_lower ON products (LOWER(name));

-- 2. Tabel untuk mencatat riwayat perubahan (Audit Log)
CREATE TABLE product_audit_log (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id BIGINT REFERENCES products(id) ON DELETE SET NULL, -- Referensi ke produk
    action_type TEXT NOT NULL, -- 'CREATE', 'UPDATE', 'DELETE'
    details JSONB,             -- Menyimpan data perubahan, misal: {"old_price": 3000, "new_price": 4000}
    requested_by TEXT,         -- Bisa diisi dengan Telegram User ID
    timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- (Opsional) Fungsi untuk auto-update kolom 'updated_at' di tabel products
CREATE OR REPLACE FUNCTION trigger_set_timestamp()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER set_timestamp
BEFORE UPDATE ON products
FOR EACH ROW
EXECUTE PROCEDURE trigger_set_timestamp();
4. Arsitektur Layanan dan Alur Data
Ini adalah inti dari sistem Anda. Kita tidak akan membiarkan LLM membuat query, kita akan membiarkan LLM memilih alat (tool).

Langkah 1: Definisikan "Alat" (Tools) di Layanan FastAPI Anda
Di dalam kode Python Anda, Anda akan mendefinisikan fungsi-fungsi yang jelas:

Python

# Ini adalah fungsi Python di sisi server Anda
# Layanan Anda akan memanggil Supabase di dalam fungsi-fungsi ini

def get_product_price(product_name: str) -> str:
    """Gunakan alat ini untuk mencari harga suatu produk."""
    # ... (Logika untuk query: SELECT price, unit FROM products WHERE name ILIKE product_name)
    # ... (Mengembalikan hasil dari Supabase)

def update_product_price(product_name: str, new_price: int, unit: str = None) -> str:
    """Gunakan alat ini untuk memperbarui harga produk yang sudah ada atau membuat produk baru jika belum ada."""
    # ... (Logika untuk query: UPDATE products SET price = new_price WHERE name ILIKE product_name)
    # ... (Jika tidak ada, CREATE: INSERT INTO products (name, price, unit) VALUES ...)
    # ... (Jangan lupa INSERT ke product_audit_log)
    # ... (Mengembalikan status sukses)

def delete_product(product_name: str) -> str:
    """Gunakan alat ini untuk menghapus produk dari database."""
    # ... (Logika untuk query: DELETE FROM products WHERE name ILIKE product_name)
    # ... (Jangan lupa INSERT ke product_audit_log)
    # ... (Mengembalikan status sukses)
Langkah 2: Alur Interaksi (Sistem "Agent")
Ini adalah bagaimana alur yang Anda jelaskan akan bekerja dengan arsitektur ini.

Alur 1: Pencarian Harga (READ)

User (Telegram): "berapa harga minyak"

Telegram -> Webhook (FastAPI di Vercel)

Layanan (FastAPI): Menerima pesan.

Layanan -> GLM (via LangChain):

Prompt Sistem: "Anda adalah asisten toko. Tugas Anda adalah memahami permintaan pengguna dan memilih salah satu dari alat berikut: get_product_price, update_product_price, delete_product. Hanya panggil satu alat."

Prompt User: "berapa harga minyak"

GLM -> Layanan:

Respon (berbentuk JSON): {"tool_to_call": "get_product_price", "parameters": {"product_name": "minyak"}}

Layanan (FastAPI):

Membaca JSON ini. "Ah, saya harus memanggil fungsi lokal saya get_product_price."

Memanggil get_product_price(product_name="minyak").

Fungsi get_product_price -> Supabase:

Menjalankan query SQL yang aman: SELECT price, unit FROM products WHERE LOWER(name) = 'minyak';

Supabase -> Layanan: [{"price": 4000, "unit": "liter"}]

Layanan (FastAPI): Mengubah data ini menjadi respons yang ramah (bisa juga meminta LLM lagi untuk ini, tapi tidak wajib).

Layanan -> Telegram: "Harga minyak saat ini adalah 4000 per liter."

Alur 2: Ubah Harga (UPDATE/CREATE)

User (Telegram): "ubah harga minyak 4000" (atau "tambah gula 17000 per kg")

Telegram -> Webhook (FastAPI di Vercel)

Layanan (FastAPI): Menerima pesan.

Layanan -> GLM (via LangChain):

Prompt Sistem: (Sama seperti di atas)

Prompt User: "ubah harga minyak 4000"

GLM -> Layanan:

Respon (berbentuk JSON): {"tool_to_call": "update_product_price", "parameters": {"product_name": "minyak", "new_price": 4000, "unit": null}}

Layanan (FastAPI):

Membaca JSON ini. "OK, panggil fungsi update_product_price."

Memanggil update_product_price(product_name="minyak", new_price=4000, unit=None).

Fungsi update_product_price -> Supabase:

Menjalankan query SQL yang aman:

UPDATE products SET price = 4000, updated_at = NOW() WHERE LOWER(name) = 'minyak';

INSERT INTO product_audit_log (product_id, action_type, details) VALUES (...);

Supabase -> Layanan: "UPDATE 1" (Sukses)

Layanan -> Telegram: "Harga minyak berhasil diperbarui menjadi 4000."

5. Keamanan dan Praktik Terbaik
Keamanan: Dengan pendekatan Function Calling ini, Anda 100% aman dari SQL Injection oleh LLM. LLM tidak pernah menyentuh database Anda. Kode Anda yang menyentuh database, dan LLM hanya memberi tahu kode Anda fungsi mana yang harus dijalankan.

Otorisasi: (Perlu dipikirkan) Saat ini, siapa pun yang tahu bot Anda bisa mengubah harga. Anda harus menambahkan pemeriksaan di layanan FastAPI Anda: if telegram_user_id not in [DAFTAR_ADMIN]: return "Anda tidak diizinkan."

Idempotensi: Fungsi update_product_price sebaiknya dirancang untuk juga bisa membuat produk baru jika product_name belum ada (ini dikenal sebagai operasi "Upsert"). Ini membuat perintah "tambah minyak 4000" dan "ubah harga minyak 4000" bisa ditangani oleh fungsi yang sama, menyederhanakan logika LLM.

Bahasa Pemrograman: Python
Alasan utama: Ekosistem AI (Kecerdasan Buatan).

LangChain: Seperti yang disebutkan di dokumen teknis, LangChain adalah "best practice" untuk menghubungkan LLM dengan "tools" (alat) seperti database Anda. LangChain memiliki dukungan paling matang dan utama di Python.

FastAPI: Ini adalah framework web Python yang akan Anda gunakan untuk membuat "service" atau "webhook". Ini sangat modern, cepat, dan mudah dipelajari. Ini adalah pilihan yang sempurna untuk menjembatani Telegram dan logika internal Anda.

Pustaka (Libraries): Semua yang Anda butuhkan memiliki pustaka Python yang stabil: supabase-py (untuk koneksi ke Supabase), python-telegram-bot (untuk mengelola bot), dan requests (untuk memanggil API GLM).